import{r as v,u as P,j as e,H as A}from"./app-Bo2Vbsnc.js";import{B as j}from"./createLucideIcon-XQw2-DSi.js";import{I as o}from"./input-okKGAgmh.js";import{L as l}from"./label-Dk2z4hvO.js";import{S as R,a as w,b as B,c as I,d as L}from"./select-VnT2g1FZ.js";import{t as m}from"./index-C2ywKrme.js";import{A as M}from"./app-layout-DdHLMRH3.js";/* empty css            */import"./index-BNGQMMhk.js";import"./index-vs_CEgml.js";import"./chevron-right-DL2bW7BS.js";import"./check-PfBPDYQe.js";import"./app-logo-icon-CS4oG-CN.js";function X({pieceJointe:t,attachableType:p,attachableId:x,typesPieces:f,breadcrumbs:N,title:_}){const u=v.useRef(null),{data:a,setData:n,post:y,put:F,processing:b,errors:r,reset:S}=P({attachable_type:t?.attachable_type||p||"",attachable_id:t?.attachable_id||x||"",type_piece:t?.type_piece||Object.keys(f)[0],numero_piece:t?.numero_piece||"",fichier:null,date_emission:t?.date_emission||"",date_expiration:t?.date_expiration||null}),[d,g]=v.useState(t?.fichier?"Fichier existant":""),C=s=>{s.preventDefault();const i=new FormData;Object.entries(a).forEach(([h,c])=>{c!=null&&(h==="fichier"&&c instanceof File?i.append(h,c,c.name):i.append(h,c))}),t?F(`/pieces-jointes/${t.id}`,{data:i,onSuccess:()=>m.success("Pièce jointe mise à jour avec succès."),onError:()=>m.error("Une erreur est survenue lors de la mise à jour."),preserveScroll:!0}):y("/pieces-jointes",{data:i,onSuccess:()=>{m.success("Pièce jointe enregistrée avec succès."),S()},onError:()=>m.error("Une erreur est survenue lors de l'enregistrement.")})},D=s=>{const i=s.target.files?.[0]||null;n("fichier",i),g(i?.name||"")},E=()=>{n("fichier",null),g(""),u.current&&(u.current.value="")};return e.jsxs(M,{breadcrumbs:N,children:[e.jsx(A,{title:_}),e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:_}),e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[!t&&p&&x&&e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm font-medium",children:"Cette pièce sera attachée à :"}),e.jsxs("p",{className:"text-sm",children:["Type: ",p.replace("App\\Models\\","")]}),e.jsxs("p",{className:"text-sm",children:["ID: ",x]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"type_piece",children:"Type de pièce *"}),e.jsxs(R,{value:a.type_piece,onValueChange:s=>n("type_piece",s),children:[e.jsx(w,{children:e.jsx(B,{placeholder:"Sélectionner un type"})}),e.jsx(I,{children:Object.entries(f).map(([s,i])=>e.jsx(L,{value:s,children:i},s))})]}),r.type_piece&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.type_piece})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"numero_piece",children:"Numéro de pièce *"}),e.jsx(o,{id:"numero_piece",value:a.numero_piece,onChange:s=>n("numero_piece",s.target.value),placeholder:"Ex: 123456789"}),r.numero_piece&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.numero_piece})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"fichier",children:"Fichier *"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{id:"fichier",type:"file",ref:u,accept:"application/pdf,image/*",onChange:D,className:"flex-1"}),d&&e.jsx(j,{type:"button",variant:"outline",onClick:E,children:"Supprimer"})]}),d&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Fichier sélectionné: ",d]}),t?.fichier&&!d&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Fichier existant: ",t.fichier]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Formats acceptés : PDF, JPG, PNG (max 2MB)"}),r.fichier&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.fichier})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"date_emission",children:"Date d'émission *"}),e.jsx(o,{id:"date_emission",type:"date",value:a.date_emission,onChange:s=>n("date_emission",s.target.value)}),r.date_emission&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.date_emission})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"date_expiration",children:"Date d'expiration"}),e.jsx(o,{id:"date_expiration",type:"date",value:a.date_expiration||"",onChange:s=>n("date_expiration",s.target.value||null),min:a.date_emission}),r.date_expiration&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.date_expiration})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>window.history.back(),children:"Annuler"}),e.jsx(j,{type:"submit",disabled:b,children:t?"Mettre à jour":"Enregistrer"})]})]})]})]})}export{X as default};
