import{u as $,r as A,j as e,H as O}from"./app-Bo2Vbsnc.js";import{B as N}from"./createLucideIcon-XQw2-DSi.js";import{I as D}from"./input-okKGAgmh.js";import{L as n}from"./label-Dk2z4hvO.js";import{S as m,a as x,b as p,c as u,d as h}from"./select-VnT2g1FZ.js";import{t as d}from"./index-C2ywKrme.js";import{A as V}from"./app-layout-DdHLMRH3.js";import{C as B}from"./checkbox-BUtb-XHJ.js";import{M as j}from"./example-date-picker-D5MQFrMm.js";import{f as b,a as S}from"./fr-BP0VUzFK.js";/* empty css            */import"./index-BNGQMMhk.js";import"./index-vs_CEgml.js";import"./chevron-right-DL2bW7BS.js";import"./check-PfBPDYQe.js";import"./app-logo-icon-CS4oG-CN.js";import"./popover-YZJZ8lM_.js";import"./chevron-left-CeZ96CWT.js";function te({document:a,mariages:v,fonctionnaires:y,typesDocuments:_,breadcrumbs:C,title:f}){const{data:i,setData:t,post:F,put:w,processing:E,errors:s,reset:I}=$({mariage_id:a?.mariage_id||"",type_document:a?.type_document||Object.keys(_)[0],numero_document:a?.numero_document||"",date_emission:a?.date_emission||"",date_expiration:a?.date_expiration||null,fichier:null,livre:a?.livre||!1,date_livraison:a?.date_livraison||null,livre_par:a?.livre_par||null}),[R,g]=A.useState(a?.fichier||null),M=r=>{r.preventDefault();const l=new FormData;Object.entries(i).forEach(([L,c])=>{c!=null&&l.append(L,c)}),a?w(`/documents-mariage/${a.id}`,{onSuccess:()=>d.success("Document mis à jour avec succès."),onError:()=>d.error("Une erreur est survenue lors de la mise à jour."),preserveScroll:!0}):F("/documents-mariage",{onSuccess:()=>{d.success("Document enregistré avec succès."),I()},onError:()=>d.error("Une erreur est survenue lors de l'enregistrement.")})},P=r=>{if(t("fichier",r),r){const l=new FileReader;l.onloadend=()=>{g(l.result)},l.readAsDataURL(r)}else g(null)},k=r=>`${r.homme?.nom} ${r.homme?.prenom} & ${r.femme?.nom} ${r.femme?.prenom}`,o=v.find(r=>r.id===Number(i.mariage_id));return e.jsxs(V,{breadcrumbs:C,children:[e.jsx(O,{title:f}),e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:f}),e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"mariage_id",children:"Mariage concerné"}),e.jsxs(m,{value:i.mariage_id.toString(),onValueChange:r=>t("mariage_id",parseInt(r)),children:[e.jsx(x,{children:e.jsx(p,{placeholder:"Sélectionner un mariage"})}),e.jsx(u,{children:v.map(r=>e.jsxs(h,{value:r.id.toString(),children:[k(r)," - ",b(new Date(r.date_mariage),"PP",{locale:S})]},r.id))})]}),s.mariage_id&&e.jsx("p",{className:"text-sm text-red-500",children:s.mariage_id}),o&&e.jsxs("div",{className:"mt-2 p-3 border rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm font-medium",children:"Informations du mariage:"}),e.jsxs("p",{className:"text-sm",children:[b(new Date(o.date_mariage),"PP",{locale:S})," à ",o.lieu_mariage]}),e.jsxs("p",{className:"text-sm",children:["Officier: ",o.officier?.nom," ",o.officier?.prenom]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"type_document",children:"Type de document"}),e.jsxs(m,{value:i.type_document,onValueChange:r=>t("type_document",r),children:[e.jsx(x,{children:e.jsx(p,{placeholder:"Sélectionner le type"})}),e.jsx(u,{children:Object.entries(_).map(([r,l])=>e.jsx(h,{value:r,children:l},r))})]}),s.type_document&&e.jsx("p",{className:"text-sm text-red-500",children:s.type_document})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"numero_document",children:"Numéro du document"}),e.jsx(D,{id:"numero_document",value:i.numero_document,onChange:r=>t("numero_document",r.target.value)}),s.numero_document&&e.jsx("p",{className:"text-sm text-red-500",children:s.numero_document})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"date_emission",children:"Date d'émission"}),e.jsx(j,{label:"Date d'émision",value:i.date_emission,onChange:r=>t("date_emission",r)}),s.date_emission&&e.jsx("p",{className:"text-sm text-red-500",children:s.date_emission})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"date_expiration",children:"Date d'expiration"}),e.jsx(j,{label:"Date d'expiration",value:i.date_expiration,onChange:r=>t("date_expiration",r),minDate:i.date_emission?new Date(i.date_emission):new Date}),s.date_expiration&&e.jsx("p",{className:"text-sm text-red-500",children:s.date_expiration})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"fichier",children:"Document scanné"}),e.jsx(D,{type:"file",id:"fichier",onChange:r=>P(r.target.files?.[0]||null),accept:"application/pdf,image/*"}),s.fichier&&e.jsx("p",{className:"text-sm text-red-500",children:s.fichier})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{id:"livre",checked:i.livre,onCheckedChange:r=>{t("livre",!!r),r||(t("date_livraison",null),t("livre_par",null))}}),e.jsx(n,{htmlFor:"livre",children:"Document livré"})]}),i.livre&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(j,{label:"Date de livraison",value:i.date_livraison,onChange:r=>t("date_livraison",r),maxDate:new Date}),s.date_livraison&&e.jsx("p",{className:"text-sm text-red-500",children:s.date_livraison})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"livre_par",children:"Livré par"}),e.jsxs(m,{value:i.livre_par?.toString()||"",onValueChange:r=>t("livre_par",parseInt(r)),children:[e.jsx(x,{children:e.jsx(p,{placeholder:"Sélectionner un fonctionnaire"})}),e.jsx(u,{children:y.map(r=>e.jsxs(h,{value:r.id.toString(),children:[r.nom," ",r.prenom," (",r.fonction,")"]},r.id))})]}),s.livre_par&&e.jsx("p",{className:"text-sm text-red-500",children:s.livre_par})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>window.history.back(),children:"Annuler"}),e.jsx(N,{type:"submit",disabled:E,children:a?"Mettre à jour":"Enregistrer"})]})]})]})]})}export{te as default};
